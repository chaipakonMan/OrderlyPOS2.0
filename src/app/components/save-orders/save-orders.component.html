<div class="saved-orders-container">
  <div class="header-row">
    <h2>ğŸ“¦ Saved Orders</h2>
    <button class="done-button" (click)="clearAllOrders()" [disabled]="orders.length === 0">ClearAll</button>
    <button class="done-button" (click)="goToHome()">Home</button>
  </div>

  <!-- Merge Mode Buttons -->
  <div class="merge-controls" *ngIf="!mergeMode && orders.length > 1">
    <button class="merge-button" (click)="startMerge()">ğŸ§© Start Merge</button>
  </div>
  <div class="merge-controls" *ngIf="mergeMode">
    <label>
      New Table Number:
      <input type="text" [(ngModel)]="mergeTableNumber" />
    </label>
    <button (click)="confirmMerge()" [disabled]="!canMerge()">âœ… Confirm Merge</button>
    <button (click)="cancelMerge()">âŒ Cancel Merge</button>
  </div>

  <div *ngIf="orders.length === 0" class="empty-state">
    <p>No saved orders found.</p>
  </div>

  <div *ngFor="let order of orders; let i = index" class="order-card">
    <!-- Merge checkbox -->
    <label *ngIf="mergeMode" class="merge-checkbox">
      <input type="checkbox" [(ngModel)]="mergeSelections[i]" />
      Select
    </label>

    <h3>Table #{{ order.tableNumber }}</h3>

    <ul class="item-list">
      <li *ngFor="let item of order.selectedFoods">
        {{ item.quantity }} x {{ item.name }}
        <span *ngIf="item.comment"> - <em>{{ item.comment }}</em></span>
      </li>
    </ul>

    <div class="order-actions" *ngIf="!mergeMode">
      <button (click)="loadForEdit(order, i)">âœï¸ Edit</button>
      <button (click)="startSplit(i)" [disabled]="order.selectedFoods.length <= 1">ğŸ’¸ Split</button>
    </div>

    <!-- Split Mode Section -->
    <div *ngIf="splitModeIndex === i" class="split-section">
      <h4>Select items to split:</h4>

      <label>
        New Table Number:
        <input type="text" [(ngModel)]="splitTableNumber" />
      </label>

      <ul class="item-list">
        <li *ngFor="let item of order.selectedFoods; let j = index">
          <label>
            <input type="checkbox" [(ngModel)]="splitSelections[j]" />
            {{ item.quantity }} x {{ item.name }}
            <span *ngIf="item.comment"> - <em>{{ item.comment }}</em></span>
          </label>
        </li>
      </ul>

      <button (click)="saveSplit(order, i)">Split</button>
      <button (click)="cancelSplit()">Cancel</button>
    </div>
  </div>
</div>
